### ========================================
### üîî TESTS DE NOTIFICACIONES CON ESTADO DE LECTURA
### ========================================

### ========================================
### PARTE 1: OBTENER NOTIFICACIONES (con campo open)
### ========================================

### 1. üì± Obtener notificaciones de usuario (todas no le√≠das inicialmente)
# Debe retornar open=1 para todas las notificaciones nuevas
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 2. üì± Obtener notificaciones de otro usuario
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### ========================================
### PARTE 2: MARCAR NOTIFICACIONES COMO LE√çDAS
### ========================================

### 3. ‚úÖ Marcar UNA notificaci√≥n como le√≠da (open=0)
# Primero obt√©n el notification_id del paso 1, ejemplo: "2_1_reminder_20251122"
POST http://localhost:8000/social/notifications/mark-as-read
Content-Type: application/json

{
  "notification_id": "2_1_reminder_20251122"
}

### 4. ‚úÖ Marcar M√öLTIPLES notificaciones como le√≠das
POST http://localhost:8000/social/notifications/mark-multiple-as-read
Content-Type: application/json

{
  "notification_ids": [
    "2_1_upcoming_20251122",
    "2_2_upcoming_20251122",
    "2_3_upcoming_20251122"
  ]
}

### 5. ‚úÖ Marcar TODAS las notificaciones de un usuario como le√≠das
POST http://localhost:8000/social/notifications/mark-all-as-read/2

### ========================================
### PARTE 3: VERIFICAR ESTADO DESPU√âS DE LEER
### ========================================

### 6. üîç Verificar que las notificaciones marcadas ahora tienen open=0
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 7. üìä Ver estad√≠sticas de notificaciones (le√≠das vs no le√≠das)
GET http://localhost:8000/social/notifications/stats/2
Accept: application/json

### ========================================
### PARTE 4: TESTS DE CONTADORES
### ========================================

### 8. üìà Obtener notificaciones - verificar unread_count
# Debe mostrar: total_notifications, unread_count, read_count
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 9. üìà Estad√≠sticas de usuario sin notificaciones
GET http://localhost:8000/social/notifications/stats/5
Accept: application/json

### ========================================
### PARTE 5: FLUJO COMPLETO DE LECTURA
### ========================================

### 10. FLUJO PASO 1: Ver notificaciones (todas open=1)
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### 11. FLUJO PASO 2: Usuario lee una notificaci√≥n espec√≠fica
POST http://localhost:8000/social/notifications/mark-as-read
Content-Type: application/json

{
  "notification_id": "4_1_upcoming_20251122"
}

### 12. FLUJO PASO 3: Verificar que esa notificaci√≥n ahora es open=0
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### 13. FLUJO PASO 4: Ver estad√≠sticas actualizadas
GET http://localhost:8000/social/notifications/stats/4
Accept: application/json

### 14. FLUJO PASO 5: Marcar el resto como le√≠das
POST http://localhost:8000/social/notifications/mark-all-as-read/4

### 15. FLUJO PASO 6: Verificar que todas son open=0
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### ========================================
### PARTE 6: TESTS DE RESETEO
### ========================================

### 16. üîÑ Limpiar historial de notificaciones le√≠das de un usuario
# Despu√©s de esto, todas las notificaciones volver√°n a ser open=1
DELETE http://localhost:8000/social/notifications/clear/2

### 17. üîç Verificar que las notificaciones volvieron a open=1
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### ========================================
### PARTE 7: TESTS DE EDGE CASES
### ========================================

### 18. ‚ùå Intentar marcar como le√≠da con notification_id inv√°lido
POST http://localhost:8000/social/notifications/mark-as-read
Content-Type: application/json

{
  "notification_id": "invalid_format"
}

### 19. ‚ùå Intentar marcar m√∫ltiples con array vac√≠o
POST http://localhost:8000/social/notifications/mark-multiple-as-read
Content-Type: application/json

{
  "notification_ids": []
}

### 20. üì≠ Usuario sin notificaciones
GET http://localhost:8000/social/notifications/user/99
Accept: application/json

### ========================================
### PARTE 8: TESTS CON DATOS DEL SEED
### ========================================

### 21. üì± Notificaciones de Juan P√©rez (user_id: 2) - desde seed
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 22. ‚úÖ Marcar algunas del seed como le√≠das
POST http://localhost:8000/social/notifications/mark-multiple-as-read
Content-Type: application/json

{
  "notification_ids": [
    "2_1_upcoming_20251122",
    "2_2_upcoming_20251122"
  ]
}

### 23. üìä Estad√≠sticas despu√©s de leer algunas
GET http://localhost:8000/social/notifications/stats/2
Accept: application/json

### 24. üì± Ver notificaciones con mezcla de le√≠das y no le√≠das
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### ========================================
### PARTE 9: TESTS DE PERSISTENCIA EN SESI√ìN
### ========================================

### 25. üìù Crear usuario de prueba
POST http://localhost:8000/auth/register
Content-Type: application/json

{
  "username": "testnotif",
  "email": "testnotif@example.com",
  "full_name": "Test Notificaciones",
  "password": "password123",
  "role": "participant"
}

### 26. üìù Crear evento pr√≥ximo para generar notificaciones
POST http://localhost:8000/events/
Content-Type: application/json

{
  "title": "Evento Test Notificaciones",
  "description": "Para probar el sistema de notificaciones",
  "date": "2025-11-23T10:00:00",
  "location": "Test Location",
  "max_participants": 50,
  "organizer_id": 1
}

### 27. üé´ Registrar al usuario en el evento (usar IDs de pasos 25 y 26)
POST http://localhost:8000/events/attend
Content-Type: application/json

{
  "user_id": 9,
  "event_id": 14
}

### 28. üì± Ver notificaciones generadas (debe aparecer con open=1)
GET http://localhost:8000/social/notifications/user/9
Accept: application/json

### 29. ‚úÖ Marcar como le√≠da
POST http://localhost:8000/social/notifications/mark-as-read
Content-Type: application/json

{
  "notification_id": "9_14_reminder_20251122"
}

### 30. üîç Verificar persistencia - debe seguir en open=0
GET http://localhost:8000/social/notifications/user/9
Accept: application/json

### ========================================
### PARTE 10: TESTS DE M√öLTIPLES USUARIOS
### ========================================

### 31. üë• Registrar m√∫ltiples usuarios al mismo evento
POST http://localhost:8000/events/attend
Content-Type: application/json

{
  "user_id": 2,
  "event_id": 14
}

###
POST http://localhost:8000/events/attend
Content-Type: application/json

{
  "user_id": 4,
  "event_id": 14
}

### 32. üì± Usuario 2 ve sus notificaciones
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 33. üì± Usuario 4 ve sus notificaciones
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### 34. ‚úÖ Usuario 2 marca sus notificaciones como le√≠das
POST http://localhost:8000/social/notifications/mark-all-as-read/2

### 35. üîç Usuario 2 verifica (todas open=0)
GET http://localhost:8000/social/notifications/user/2
Accept: application/json

### 36. üîç Usuario 4 verifica (sus notificaciones siguen en open=1)
GET http://localhost:8000/social/notifications/user/4
Accept: application/json

### ========================================
### PARTE 11: TESTS DE INTEGRACI√ìN CON CAMBIOS DE EVENTOS
### ========================================

### 37. üìù Actualizar evento que tiene asistentes
PUT http://localhost:8000/events/14
Content-Type: application/json

{
  "date": "2025-11-24T15:00:00",
  "location": "Nueva Ubicaci√≥n Test"
}

### 38. üì± Ver notificaciones despu√©s del cambio (nuevas notificaciones con open=1)
GET http://localhost:8000/social/notifications/user/9
Accept: application/json

### 39. üìä Comparar estad√≠sticas antes y despu√©s del cambio
GET http://localhost:8000/social/notifications/stats/9
Accept: application/json

### ========================================
### PARTE 12: OBTENER RECORDATORIOS DEL SISTEMA
### ========================================

### 40. üîî Obtener todos los eventos que necesitan recordatorio
# Este endpoint NO usa el sistema de read/unread
GET http://localhost:8000/social/notifications/reminders
Accept: application/json

### ========================================
### üìù RESUMEN DE TESTS
### ========================================

# Total de tests: 40

# FUNCIONALIDADES CUBIERTAS:
# ‚úÖ Obtener notificaciones con campo open (0 o 1)
# ‚úÖ Marcar una notificaci√≥n como le√≠da
# ‚úÖ Marcar m√∫ltiples notificaciones como le√≠das
# ‚úÖ Marcar todas las notificaciones como le√≠das
# ‚úÖ Obtener estad√≠sticas (total, le√≠das, no le√≠das)
# ‚úÖ Resetear estado de lectura de usuario
# ‚úÖ Persistencia en memoria durante la sesi√≥n
# ‚úÖ Independencia entre usuarios
# ‚úÖ Integraci√≥n con cambios de eventos
# ‚úÖ Edge cases y validaciones

### ========================================
### üìä FORMATO DE RESPUESTA ESPERADO
### ========================================

# GET /notifications/user/{user_id}
# {
#   "user_id": 2,
#   "total_notifications": 5,
#   "unread_count": 3,
#   "read_count": 2,
#   "notifications": [
#     {
#       "notification_id": "2_1_reminder_20251122",
#       "event_id": 1,
#       "event_title": "Conferencia de Tecnolog√≠a 2025",
#       "event_date": "2025-12-25T10:00:00",
#       "event_location": "Centro de Convenciones",
#       "notification_type": "reminder",
#       "message": "¬°Recordatorio! El evento...",
#       "days_until_event": 0,
#       "open": 1,  <-- 1 = no le√≠da, 0 = le√≠da
#       "created_at": "2025-11-22T10:30:00"
#     }
#   ]
# }

# POST /notifications/mark-as-read
# Response:
# {
#   "message": "Notification marked as read",
#   "notification_id": "2_1_reminder_20251122",
#   "open": 0
# }

# GET /notifications/stats/{user_id}
# {
#   "user_id": 2,
#   "total_notifications": 5,
#   "unread_count": 2,
#   "read_count": 3
# }

### ========================================
### üí° NOTAS IMPORTANTES
### ========================================

# 1. El campo "open" funciona as√≠:
#    - open = 1 ‚Üí Notificaci√≥n NO le√≠da (nueva)
#    - open = 0 ‚Üí Notificaci√≥n LE√çDA

# 2. El estado se mantiene en MEMORIA (no en BD)
#    - Persiste mientras la aplicaci√≥n est√© corriendo
#    - Se pierde al reiniciar el servidor (por dise√±o)

# 3. Cada usuario tiene su propio estado independiente
#    - Usuario A puede marcar sus notificaciones como le√≠das
#    - Usuario B seguir√° viendo las suyas como no le√≠das

# 4. Los notification_id tienen el formato:
#    "{user_id}_{event_id}_{type}_{date}"
#    Ejemplo: "2_1_reminder_20251122"

# 5. Para producci√≥n, podr√≠as implementar:
#    - Redis para persistencia entre reinicios
#    - Tabla en BD (si cambias de opini√≥n)
#    - localStorage en el cliente (frontend)

### ========================================